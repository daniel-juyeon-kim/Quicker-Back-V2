## 문제

개발자가 새로운 기능을 개발할 때 직접 테스트하면서 개발했습니다. 그러다가 기존 코드를 리팩토링하면서 다음과 같은 문제가 있었습니다.

- 리팩토링 후 동작이 달라짐
- 직접 테스트하는 방법은 일시적이고 오래 걸림
- 배포된 서버에서 놓친 엣지 케이스가 나옴

## 해결

테스트 코드를 작성해 해결했습니다. 외부 API 어댑터와 레포지토리가 외부 환경에 의존해서 **모킹과 인메모리 DB(SQLite)로 테스트**했습니다.

### 레포지토리 계층 테스트

레포지토리 계층을 테스트하려면 DB를 사용해야해서 인 메모리 DB(SQLite)와 도커 가상 DB 중 장단점을 비교 후 인 메모리 DB(SQLite)로 테스트 환경을 설정했습니다.

#### 인 메모리 DB 장단점

장점

- **테스트 속도 빠름**
- 설정 적음
- 여러 DB에 호환되는 코드를 작성할 수 있음

단점

- 배포와 테스트 환경의 DB가 다름

#### 도커 가상 DB 장단점

장점

- 배포 환경과 동일한 DB 사용

단점

- 상대적으로 **테스트 속도 느림**
- 도커 설정해야 함
  <!-- - 도커 설정 파일 작성이 귀찮음
  - CI에서 테스트 환경 설정에 시간이 걸림 -->

### 외부 API 어댑터 테스트

외부 API 어댑터는 **사용 요금, 화이트리스트, API 서버 상태에 따라 테스트 결과가 달라지는 문제**가 있습니다. 이때 **모킹**을 사용할 수 있습니다.

모킹은 의존성을 가짜로 만들고 동작을 가정해 테스트하는 방법으로 외부환경에 영향을 받지 않아 테스트 결과가 달라지지 않는 장점이 있습니다. 하지만 모킹은 실제 동작이 아니므로 주의해서 사용해야 합니다.

프로젝트에서는 Slack, Naver SMS, Tmap 등의 외부 API 어댑터를 모킹하고 테스트했습니다.

## 성과

테스트 코드를 도입하면서 다음과 같은 성과가 있었습니다.

- **테스트 커버리지 95.52%**
- 구현한 기능을 **안정적으로 리팩토링** 가능
- 지속적이고 빠른 테스트로 개발에 더 집중할 수 있음
- 엣지 케이스가 누락될 확률이 줄어듦
